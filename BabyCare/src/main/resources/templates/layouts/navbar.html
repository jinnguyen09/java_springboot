<div th:fragment="navbar" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <div class="container-fluid border-bottom bg-light wow fadeIn" data-wow-delay="0.1s">

        <!-- Topbar -->
        <div class="container topbar bg-primary d-none d-lg-block py-2" style="border-radius: 0 40px">
            <div class="d-flex justify-content-between">
                <div class="top-info ps-2">
                    <small class="me-3"><i class="fas fa-map-marker-alt me-2 text-secondary"></i>
                        <a href="#" class="text-white">TP Vinh, Nghệ An</a>
                    </small>
                    <small class="me-3"><i class="fas fa-envelope me-2 text-secondary"></i>
                        <a href="#" class="text-white">thiepthanhx03@gmail.com</a>
                    </small>
                    <small class="me-3"><i class="fas fa-phone me-2 text-secondary"></i>
                        <a href="#" class="text-white">0899073387</a>
                    </small>
                </div>

                <div class="top-link pe-2">
                    <a href="#" class="btn btn-light btn-sm-square rounded-circle"><i class="fab fa-facebook-f text-secondary"></i></a>
                    <a href="#" class="btn btn-light btn-sm-square rounded-circle"><i class="fab fa-twitter text-secondary"></i></a>
                    <a href="#" class="btn btn-light btn-sm-square rounded-circle"><i class="fab fa-instagram text-secondary"></i></a>
                    <a href="#" class="btn btn-light btn-sm-square rounded-circle me-0"><i class="fab fa-tiktok text-secondary"></i></a>
                </div>
            </div>
        </div>

        <!-- Navbar -->
        <div class="container px-0">
            <nav class="navbar navbar-light navbar-expand-xl py-3">

                <!-- Logo -->
                <a th:href="@{/}" class="navbar-brand">
                    <h1 class="text-primary display-6">Baby<span class="text-secondary">Care</span></h1>
                </a>

                <button class="navbar-toggler py-2 px-3" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarCollapse">
                    <span class="fa fa-bars text-primary"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarCollapse">

                    <!-- Menu trái -->
                    <div class="navbar-nav mx-auto">
                        <a th:href="@{/home}" class="nav-item nav-link"
                           th:classappend="${activePage == 'home'} ? ' active' : ''">Home</a>

                        <a th:href="@{/about}" class="nav-item nav-link"
                           th:classappend="${activePage == 'about'} ? ' active' : ''">About</a>

                        <a th:href="@{/service}" class="nav-item nav-link"
                           th:classappend="${activePage == 'service'} ? ' active' : ''">Services</a>

                        <a th:href="@{/program}" class="nav-item nav-link"
                           th:classappend="${activePage == 'program'} ? ' active' : ''">Programs</a>

                        <a th:href="@{/event}" class="nav-item nav-link"
                           th:classappend="${activePage == 'event'} ? ' active' : ''">Events</a>

                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                               th:classappend="${activePage == 'pages'} ? ' active' : ''">Pages</a>
                            <div class="dropdown-menu m-0 bg-secondary rounded-0">
                                <a th:href="@{/blog}" class="dropdown-item">Our Blog</a>
                                <a th:href="@{/team}" class="dropdown-item">Our Team</a>
                                <a th:href="@{/testimonial}" class="dropdown-item">Testimonial</a>
                                <a th:href="@{/404}" class="dropdown-item">404 Page</a>
                            </div>
                        </div>

                        <a th:href="@{/contact}" class="nav-item nav-link"
                           th:classappend="${activePage == 'contact'} ? ' active' : ''">Contact</a>
                    </div>

                    <!-- Bên phải -->
                    <div class="d-flex align-items-center gap-4 ms-3">

                        <!-- Giỏ hàng (giữ nguyên) -->
                        <button type="button" class="btn btn-outline-primary d-flex align-items-center gap-2"
                                data-bs-toggle="modal" data-bs-target="#cartModal">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Giỏ hàng</span>
                            <span class="badge bg-danger rounded-pill" id="cartCount">0</span>
                        </button>

                        <!-- Nếu chưa đăng nhập -->
                        <div sec:authorize="isAnonymous()" class="d-flex align-items-center gap-3">
                            <button type="button" class="btn btn-primary d-flex align-items-center gap-2"
                                    data-bs-toggle="modal" data-bs-target="#loginModal">
                                <i class="fas fa-user"></i>
                                <span>Đăng nhập</span>
                            </button>
                        </div>

                        <!-- Nếu là USER -->
                        <div sec:authorize="hasRole('USER')" class="d-flex align-items-center gap-3">
                            <a th:href="@{/profile}" class="btn btn-outline-primary d-flex align-items-center gap-2">
                                <i class="fas fa-user"></i>
                                <span sec:authentication="name">Profile</span>
                            </a>
                            <form th:action="@{/auth/logout}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="submit" class="btn btn-outline-secondary">Đăng xuất</button>
                            </form>
                        </div>

                        <!-- Nếu là ADMIN -->
                        <div sec:authorize="hasRole('ADMIN')" class="d-flex align-items-center gap-3">
                            <a th:href="@{/admin/dashboard}" class="btn btn-outline-danger d-flex align-items-center gap-2">
                                <i class="fas fa-user-shield"></i>
                                <span>Admin</span>
                            </a>
                            <form th:action="@{/auth/logout}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="submit" class="btn btn-outline-secondary">Đăng xuất</button>
                            </form>
                        </div>
                    </div>

                </div>
            </nav>
        </div>
    </div>

    <!-- Modal Login (đã thêm id cho input pass + nút toggle) -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-0">
                <div class="modal-header">
                    <h5 class="modal-title">Đăng nhập</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div th:if="${loginError}" class="alert alert-danger text-center">
                        <span th:text="${loginError}"></span>
                    </div>

                    <form th:action="@{/auth/login}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                        <div class="mb-3">
                            <label class="form-label">Tên đăng nhập / Email</label>
                            <input type="text" name="username" class="form-control" required id="loginUsername">
                        </div>

                        <div class="mb-3 position-relative">
                            <label class="form-label">Mật khẩu</label>
                            <div class="input-group">
                                <input type="password" name="password" class="form-control" required id="loginPassword">
                                <button class="btn btn-outline-secondary" type="button" id="toggleLoginPwd" tabindex="-1">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Đăng nhập</button>

                        <div class="text-center mt-3">
                            <small>Chưa có tài khoản?
                                <a href="#" data-bs-target="#registerModal" data-bs-toggle="modal" data-bs-dismiss="modal">Đăng ký</a>
                            </small>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <!-- Modal Register (thêm id input + nút toggle, id form để validate JS nếu cần) -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-0">
                <div class="modal-header">
                    <h5 class="modal-title">Đăng ký</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div th:if="${registerSuccess}" class="alert alert-success text-center">
                        <span th:text="${registerSuccess}"></span>
                    </div>

                    <form th:action="@{/auth/register}" method="post" id="registerForm">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                        <div class="mb-3">
                            <label>Họ và tên</label>
                            <input type="text" name="fullname" class="form-control" required id="regFullname">
                        </div>

                        <div class="mb-3">
                            <label>Tên đăng nhập</label>
                            <input type="text" name="username" class="form-control" required id="regUsername">
                        </div>

                        <div class="mb-3">
                            <label>Email</label>
                            <input type="email" name="email" class="form-control" required id="regEmail">
                        </div>

                        <div class="mb-3">
                            <label>Số điện thoại</label>
                            <input type="text" name="phone" class="form-control" id="regPhone">
                        </div>

                        <div class="mb-3 position-relative">
                            <label>Mật khẩu</label>
                            <div class="input-group">
                                <input type="password" name="password" class="form-control" required id="regPassword">
                                <button class="btn btn-outline-secondary" type="button" id="toggleRegPwd" tabindex="-1">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="mb-3 position-relative">
                            <label>Xác nhận mật khẩu</label>
                            <div class="input-group">
                                <input type="password" name="confirmPassword" class="form-control" required id="regConfirm">
                                <button class="btn btn-outline-secondary" type="button" id="toggleRegConfirm" tabindex="-1">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div id="registerError" class="text-danger mb-3" style="display:none"></div>

                        <button type="submit" class="btn btn-primary w-100">Đăng ký</button>

                        <div class="text-center mt-3">
                            <small>Đã có tài khoản?
                                <a href="#" data-bs-target="#loginModal" data-bs-toggle="modal" data-bs-dismiss="modal">Đăng nhập</a>
                            </small>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>

</div>

<script>
    function togglePasswordBtn(inputId, btnId) {
        const input = document.getElementById(inputId);
        const btn = document.getElementById(btnId);
        if(!input || !btn) return;
        btn.addEventListener('click', function(){
            if(input.type === 'password'){
                input.type = 'text';
                const icon = btn.querySelector('i');
                if(icon) { icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash'); }
            } else {
                input.type = 'password';
                const icon = btn.querySelector('i');
                if(icon) { icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye'); }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function(){
        // gọi lại toggle cho các id mới
        togglePasswordBtn('loginPassword','toggleLoginPwd');
        togglePasswordBtn('regPassword','toggleRegPwd');
        togglePasswordBtn('regConfirm','toggleRegConfirm');

        // register form validation (bảo đảm id trùng với form)
        const registerForm = document.getElementById('registerForm');
        if(registerForm){
            registerForm.addEventListener('submit', function(e){
                const pwd = document.getElementById('regPassword').value;
                const confirm = document.getElementById('regConfirm').value;
                const err = document.getElementById('registerError');
                if(pwd !== confirm){
                    e.preventDefault();
                    err.style.display = 'block';
                    err.textContent = 'Mật khẩu và xác nhận mật khẩu không khớp.';
                    return false;
                }
                err.style.display = 'none';
            });
        }
    });
</script>

